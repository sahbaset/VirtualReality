<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
</head>
<body>
    <script>
        // Register the interactive component
        AFRAME.registerComponent('interactive', {
            init: function() {
                // Just a placeholder to mark entities as interactive
            }
        });
        
        // Register the spawn-fireflies component
        AFRAME.registerComponent('spawn-fireflies', {
            init: function () {
                this.el.addEventListener('click', this.onClick.bind(this));
                // Hand pinch event for Quest hand tracking
                this.el.addEventListener('pinchstarted', this.onClick.bind(this));
            },
            
            onClick: function() {
                const x = (Math.random() - 0.5) * 3;
                const y = 1 + Math.random() * 1.5;
                const z = (Math.random() - 0.5) * -3;
                this.el.setAttribute('position', `${x} ${y} ${z}`);
                
                // Flash effect when clicked
                const originalColor = this.el.getAttribute('material').color;
                this.el.setAttribute('material', 'color', '#FFFFFF');
                setTimeout(() => {
                    this.el.setAttribute('material', 'color', originalColor);
                }, 200);
            }
        });
    </script>

    <a-scene webxr="optionalFeatures: hand-tracking, local-floor; referenceSpaceType: local-floor">
        <!-- Enable hand tracking -->
        <a-entity hand-tracking="hand: left;"></a-entity>
        <a-entity hand-tracking="hand: right;"></a-entity>
        
        <a-entity camera look-controls position="0 1.6 0">
            <!-- Gaze-based cursor for hand tracking pinch gestures -->
            <a-entity cursor="fuse: true; fuseTimeout: 500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat"
                      raycaster="objects: [interactive]; far: 5;"></a-entity>
        </a-entity>
        
        <!-- Firefly Entity -->
        <a-entity id="firefly" 
                  geometry="primitive: sphere; radius: 0.1" 
                  material="color: yellow; emissive: yellow; emissiveIntensity: 1; shader: flat" 
                  position="0 1.5 -1" 
                  light="type: point; intensity: 0.5; distance: 0.5; color: yellow"
                  interactive
                  spawn-fireflies
                  animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; dur: 1000; loop: true; easing: easeInOutSine"></a-entity>
                  
        <a-sky color="#001133"></a-sky>
        
        <!-- Simple instructions -->
        <a-entity text="value: Look at the firefly and pinch to move it!; align: center; width: 1" 
                  position="0 1 -2" material="color: white"></a-entity>
    </a-scene>
</body>
</html>