<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-xr@1.2.0/dist/aframe-xr.min.js"></script>
</head>
<body>
    <a-scene webxr="optionalFeatures: hit-test;" xr-mode="immersive-ar">
        <a-camera position="0 1.6 0" look-controls></a-camera>
        
        <!-- Hand Controls -->
        <a-entity id="leftHand" hand-tracking-controls="hand: left"></a-entity>
        <a-entity id="rightHand" hand-tracking-controls="hand: right"></a-entity>
        
        <!-- Score UI -->
        <a-entity id="scoreboard" text="value: Score: 0; color: white; width: 2" position="0 2 -2"></a-entity>
        
        <!-- Firefly Spawner -->
        <a-entity id="firefly-container"></a-entity>
        
        <script>
            AFRAME.registerComponent('spawn-fireflies', {
                init: function () {
                    this.spawnFirefly();
                },
                spawnFirefly: function () {
                    const container = document.getElementById('firefly-container');
                    const firefly = document.createElement('a-entity');
                    
                    const x = 0
                    const y = 1.5
                    const z = -1
                    
                    firefly.setAttribute('geometry', 'primitive: sphere; radius: 0.1');
                    firefly.setAttribute('material', 'color: yellow; emissive: yellow; emissiveIntensity: 1');
                    firefly.setAttribute('position', `${x} ${y} ${z}`);
                    firefly.setAttribute('firefly', '');
                    firefly.setAttribute('grabbable', '');
                    
                    container.appendChild(firefly);
                }
            });
            
            AFRAME.registerComponent('firefly', {
                init: function () {
                    this.el.addEventListener('mouseenter', () => {
                        this.el.parentNode.removeChild(this.el);
                        increaseScore();
                    });
                }
            });
            
            let score = 0;
            function increaseScore() {
                score++;
                document.getElementById('scoreboard').setAttribute('text', `value: Score: ${score};`);
                setTimeout(() => document.querySelector('a-scene').components['spawn-fireflies'].spawnFirefly(), 1000);
            }
            
            AFRAME.registerComponent('grabbable', {
                init: function () {
                    this.el.addEventListener('grab-start', () => {
                        this.el.setAttribute('dynamic-body', '');
                    });
                    this.el.addEventListener('grab-end', () => {
                        this.el.removeAttribute('dynamic-body');
                    });
                }
            });
            
            document.querySelector('a-scene').setAttribute('spawn-fireflies', '');
        </script>
    </a-scene>
</body>
</html>